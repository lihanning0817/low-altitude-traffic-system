# 前后端功能对齐检查报告

> 生成时间：2025-10-15
> 项目：智能低空交通系统

---

## 一、前端API调用清单

### 1.1 认证模块 (authApi.js)
**基础URL**: `/api/v1/auth`

| API端点 | 方法 | 参数 | 期望返回 |
|---------|------|------|----------|
| `/register` | POST | username, email, password, full_name | user对象 |
| `/login` | POST | username, password | access_token, refresh_token, user |
| `/me` | GET | (需要Token) | user对象 |
| `/password` | PUT | old_password, new_password | 成功消息 |
| `/refresh` | POST | refresh_token | access_token |
| `/logout` | POST | (需要Token) | 成功消息 |

---

### 1.2 飞行任务模块 (flightTaskApi.js)
**基础URL**: `http://localhost:8081/api/v1/tasks`

| API端点 | 方法 | 参数 | 期望返回 |
|---------|------|------|----------|
| `/` | GET | status, limit, offset, signal | tasks数组 |
| `/` | POST | name, description, route, scheduled_time, status | task对象 |
| `/{id}` | GET | id | task对象 |
| `/{id}` | PUT | name, description, route, status | task对象 |
| `/{id}` | DELETE | id | 成功消息 |

---

### 1.3 飞行许可模块 (permitApi.js)
**基础URL**: `/api/v1/flight-permits`

| API端点 | 方法 | 参数 | 期望返回 |
|---------|------|------|----------|
| `/` | GET | status, applicant_id | permits数组 |
| `/{permitId}` | GET | permitId | permit对象 |
| `/` | POST | task_id, airspace_id, start_time, end_time, remarks | permit对象 |
| `/{permitId}/approve` | POST | permitId | 成功消息 |
| `/{permitId}/reject` | POST | permitId, reason | 成功消息 |
| `/{permitId}/revoke` | POST | permitId, reason | 成功消息 |

---

### 1.4 无人机管理模块 (droneApi.js)
**基础URL**: `/api/v1/drones`

| API端点 | 方法 | 参数 | 期望返回 |
|---------|------|------|----------|
| `/` | GET | status, battery_min, model | drones数组, total, active_count |
| `/{droneId}` | GET | droneId | drone对象 |

**注意**: 前端还包含客户端方法：
- `getActiveDrones()` - 过滤status=active
- `getLowBatteryDrones(threshold)` - 过滤battery<=threshold
- `getDroneStatus(droneId)` - 获取详情并分析
- `getDroneStatistics()` - 本地统计
- `getNearbyDrones(lat, lng, radius)` - 本地计算距离

---

### 1.5 空域管理模块 (airspaceApi.js)
**基础URL**: `/api/v1/airspaces`

| API端点 | 方法 | 参数 | 期望返回 |
|---------|------|------|----------|
| `/` | GET | 查询参数 | airspaces数组 |
| `/{airspaceId}` | GET | airspaceId | airspace对象 |
| `/` | POST | name, type, 坐标信息 | airspace对象 |
| `/{airspaceId}` | PUT | airspaceId, 更新数据 | airspace对象 |
| `/{airspaceId}` | DELETE | airspaceId | 成功消息 |

**注意**: 前端还包含客户端方法：
- `checkPointInAirspace(lat, lng, airspace)` - 本地检查
- `findAirspacesContainingPoint(lat, lng)` - 获取列表后本地过滤
- `getAirspaceStatistics()` - 本地统计

---

### 1.6 天气集成模块 (weatherApi.js)
**基础URL**: `/api/v1/weather`

| API端点 | 方法 | 参数 | 期望返回 |
|---------|------|------|----------|
| `/current` | GET | city, country | weather对象 |
| `/current/coords` | GET | lat, lon | weather对象 |
| `/forecast` | GET | lat, lon | forecast数组 |
| `/flight-safety` | GET | lat, lon | safety评分, weather |

---

### 1.7 应急响应模块 (emergencyApi.js)
**基础URL**: `/api/v1/emergency`

| API端点 | 方法 | 参数 | 期望返回 |
|---------|------|------|----------|
| `/events` | POST | task_id, type, severity, title, description, location | event对象 |
| `/events` | GET | page, page_size, status, severity | events数组, page, total |
| `/events/{eventId}` | GET | eventId | event对象 |
| `/events/{eventId}/respond` | POST | eventId, response_action, response_notes | event对象 |
| `/events/{eventId}/resolve` | POST | eventId | event对象 |
| `/events/{eventId}/cancel` | POST | eventId | event对象 |
| `/statistics` | GET | - | statistics对象 |

---

### 1.8 应急降落点模块 (emergencyLandingApi.js)
**基础URL**: `http://localhost:8081/api/v1/emergency-landing-points`

| API端点 | 方法 | 参数 | 期望返回 |
|---------|------|------|----------|
| `/` | GET | 查询参数 | landing_points数组 |
| `/{id}` | GET | id | landing_point对象 |
| `/` | POST | name, latitude, longitude, type, 其他字段 | landing_point对象 |
| `/{id}` | PUT | id, 更新数据 | landing_point对象 |
| `/{id}` | DELETE | id | 成功消息 |
| `/nearest` | GET | lat, lng, limit, radius | landing_points数组 |

---

### 1.9 冲突检测模块 (conflictDetectionApi.js)
**基础URL**: `http://localhost:8081/api/v1/conflict-detection`

| API端点 | 方法 | 参数 | 期望返回 |
|---------|------|------|----------|
| `/flights` | POST | task_id, start_time, end_time, route, altitude | conflicts数组 |
| `/flights/batch` | POST | flights数组 | 批量冲突结果 |
| `/conflicts` | GET | status, severity, flight_id | conflicts数组 |
| `/conflicts/{id}` | GET | id | conflict对象 |
| `/conflicts/{id}/resolve` | POST | id, resolutionData | conflict对象 |
| `/conflicts/statistics` | GET | 查询参数 | statistics对象 |

---

### 1.10 系统监控模块 (systemMonitorApi.js)
**基础URL**: `http://localhost:8081/api/v1`

| API端点 | 方法 | 参数 | 期望返回 |
|---------|------|------|----------|
| `/health` | GET | - | status, services, uptime_seconds |
| `/info` | GET | - | name, version, environment, start_time |
| `/drones` | GET | (需要Token) | drones数组, total, active_count |
| `/users` | GET | offset, limit, role (需要admin权限) | users数组, pagination |

---

## 二、后端API实现清单

### 2.1 认证控制器 (AuthController.cpp)
**路由前缀**: `/api/v1/auth`

| API端点 | 方法 | 接收参数 | 返回字段 |
|---------|------|----------|----------|
| `/login` | POST | username, password, role(可选) | access_token, refresh_token, user |
| `/register` | POST | username, email, password, full_name, role(可选) | user |
| `/refresh` | POST | refresh_token | access_token, user |
| `/me` | GET | (需要Token) | user对象 |
| `/password` | PUT | old_password, new_password | 成功消息 |
| `/logout` | POST | (需要Token) | 成功消息 |

---

### 2.2 飞行任务控制器 (FlightTaskController.cpp)
**路由前缀**: `/api/v1/tasks`

| API端点 | 方法 | 接收参数 | 返回字段 |
|---------|------|----------|----------|
| `/` | GET | status, limit, offset | tasks数组 |
| `/` | POST | name, description, route, status, scheduled_time | task对象 |
| `/{task_id}` | GET | task_id | task对象 |
| `/{task_id}` | PUT | name, description, route, status | task对象 |
| `/{task_id}` | DELETE | task_id | 成功消息 |

---

### 2.3 飞行许可控制器 (FlightPermitController.cpp)
**路由前缀**: `/api/v1/flight-permits` (推测)

| API端点 | 方法 | 接收参数 | 返回字段 |
|---------|------|----------|----------|
| `/` | POST | task_id, airspace_id, start_time, end_time, remarks | permit_id, permit_code, status |
| `/` | GET | status, applicant_id | permits数组 |
| `/{permit_id}/approve` | POST | permit_id (需要admin权限) | 成功消息 |
| `/{permit_id}/reject` | POST | permit_id (需要admin权限) | 成功消息 |

---

### 2.4 天气控制器 (WeatherController.cpp)
**路由前缀**: `/api/v1/weather`

| API端点 | 方法 | 接收参数 | 返回字段 |
|---------|------|----------|----------|
| `/current` | GET | city, country | weather对象 |
| `/current/coords` | GET | lat, lon | weather对象 |
| `/forecast` | GET | lat, lon | forecast数组, city信息 |
| `/flight-safety` | GET | lat, lon | safety对象, weather |

---

### 2.5 应急响应控制器 (EmergencyController.cpp)
**路由前缀**: `/api/v1/emergency`

| API端点 | 方法 | 接收参数 | 返回字段 |
|---------|------|----------|----------|
| `/events` | POST | task_id, drone_id, type, severity, title, description, location | event对象 |
| `/events` | GET | page, page_size, status, severity | events数组, page, total |
| `/events/{event_id}` | GET | event_id | event对象 |
| `/events/{event_id}/respond` | POST | event_id, response_action, response_notes | event对象 |
| `/events/{event_id}/resolve` | POST | event_id | event对象 |
| `/events/{event_id}/cancel` | POST | event_id | event对象 |
| `/statistics` | GET | - | statistics对象 |

---

### 2.6 应急降落点控制器 (EmergencyLandingController.cpp)
**路由前缀**: `/api/v1/emergency-landing-points` (推测)

| API端点 | 方法 | 接收参数 | 返回字段 |
|---------|------|----------|----------|
| `/` | GET | type, status, safety_rating | landing_points数组 |
| `/` | POST | name, type, lat, lng, altitude, capacity (需要admin权限) | point_id, point_code |
| `/{point_id}` | PUT | point_id, 更新字段 (需要admin权限) | 成功消息 |
| `/nearest` | GET | lat, lng, limit, radius | landing_points数组 |

---

### 2.7 冲突检测控制器 (ConflictDetectionController.cpp)
**路由前缀**: `/api/v1/conflict-detection` 或 `/api/v1/conflicts` (推测)

| API端点 | 方法 | 接收参数 | 返回字段 |
|---------|------|----------|----------|
| `/flights` | POST | task_id, start_time, end_time, route, altitude | flight_id, conflicts数组 |
| `/conflicts` | GET | status, severity, task_id | conflicts数组 |
| `/conflicts/{conflict_id}/resolve` | POST | conflict_id, resolution_notes | 成功消息 |

---

### 2.8 系统监控控制器 (SystemMonitorController.cpp)
**路由前缀**: `/api/v1`

| API端点 | 方法 | 接收参数 | 返回字段 |
|---------|------|----------|----------|
| `/health` | GET | - | status, services, uptime_seconds |
| `/info` | GET | - | name, version, environment, start_time |
| `/drones` | GET | (需要用户认证) | drones数组, total, active_count |
| `/users` | GET | offset, limit, role (需要admin权限) | users数组, pagination |

---

## 三、不一致问题汇总

### 3.1 前端调用但后端未实现 ❌

| 前端文件 | API路径 | HTTP方法 | 影响功能 | 严重性 |
|---------|---------|----------|----------|--------|
| permitApi.js | `/api/v1/flight-permits/{permitId}` | GET | 获取单个许可详情 | **High** |
| permitApi.js | `/api/v1/flight-permits/{permitId}/revoke` | POST | 撤销飞行许可 | **High** |
| droneApi.js | `/api/v1/drones/{droneId}` | GET | 获取单个无人机详情 | **High** |
| airspaceApi.js | `/api/v1/airspaces` | GET | 获取空域列表 | **Critical** |
| airspaceApi.js | `/api/v1/airspaces/{airspaceId}` | GET | 获取空域详情 | **Critical** |
| airspaceApi.js | `/api/v1/airspaces` | POST | 创建空域 | **Critical** |
| airspaceApi.js | `/api/v1/airspaces/{airspaceId}` | PUT | 更新空域 | **Critical** |
| airspaceApi.js | `/api/v1/airspaces/{airspaceId}` | DELETE | 删除空域 | **Critical** |
| emergencyLandingApi.js | `/api/v1/emergency-landing-points/{id}` | GET | 获取单个降落点详情 | **High** |
| emergencyLandingApi.js | `/api/v1/emergency-landing-points/{id}` | DELETE | 删除降落点 | **Medium** |
| conflictDetectionApi.js | `/api/v1/conflict-detection/flights/batch` | POST | 批量检测冲突 | **Medium** |
| conflictDetectionApi.js | `/api/v1/conflict-detection/conflicts/{id}` | GET | 获取单个冲突详情 | **Medium** |
| conflictDetectionApi.js | `/api/v1/conflict-detection/conflicts/statistics` | GET | 获取冲突统计 | **Low** |

---

### 3.2 后端实现但前端未使用 ⚠️

| 后端控制器 | API路径 | HTTP方法 | 建议操作 |
|-----------|---------|----------|----------|
| 无明显未使用接口 | - | - | 前端已覆盖大部分后端功能 |

---

### 3.3 参数不一致 ⚠️

| API路径 | 前端参数 | 后端参数 | 差异说明 |
|---------|----------|----------|----------|
| `/api/v1/auth/login` | username, password | username, password, role(可选) | 后端支持role验证，但前端未传递 |
| `/api/v1/auth/register` | username, email, password, full_name | username, email, password, full_name, role(可选) | 后端支持role字段，前端未传递 |
| `/api/v1/emergency/events` (POST) | task_id, type, severity, title, description, location | task_id, drone_id(可选), type, severity, title, description, location | 后端支持drone_id，前端未传递 |

---

### 3.4 返回字段不匹配 ⚠️

| API路径 | 前端期望 | 后端返回 | 差异说明 |
|---------|----------|----------|----------|
| `/api/v1/flight-permits` (POST) | permit对象(完整) | permit_id, permit_code, status | 后端返回字段较少，前端可能需要再次查询 |
| `/api/v1/emergency-landing-points` (POST) | landing_point对象(完整) | point_id, point_code | 后端返回字段较少，前端可能需要再次查询 |
| `/api/v1/conflict-detection/flights` (POST) | conflicts数组 | flight_id, conflicts数组 | 字段基本一致，但结构略有不同 |

---

### 3.5 URL路径不一致 ⚠️

| 模块 | 前端baseURL | 后端实际路径 | 备注 |
|------|------------|-------------|------|
| 飞行任务 | `http://localhost:8081/api/v1/tasks` | `/api/v1/tasks` | 前端使用完整URL，可能绕过代理 |
| 应急降落点 | `http://localhost:8081/api/v1/emergency-landing-points` | 推测为 `/api/v1/emergency-landing-points` | 前端使用完整URL |
| 冲突检测 | `http://localhost:8081/api/v1/conflict-detection` | 推测为 `/api/v1/conflicts` 或 `/api/v1/conflict-detection` | 路径可能不一致 |
| 系统监控 | `http://localhost:8081/api/v1` | `/api/v1` | 前端使用完整URL |

---

## 四、修复建议

### 4.1 需要添加的后端接口 (Critical优先级)

#### 4.1.1 空域管理控制器 (AirspaceController) - **Critical**
**文件位置**: `backend/src/controllers/AirspaceController.h` 和 `.cpp`

需要实现以下接口：
```cpp
// GET /api/v1/airspaces - 获取空域列表
http::response<http::string_body> getAirspaces(const http::request<http::string_body>& req);

// GET /api/v1/airspaces/{airspaceId} - 获取空域详情
http::response<http::string_body> getAirspaceById(const http::request<http::string_body>& req, const std::string& airspaceId);

// POST /api/v1/airspaces - 创建空域
http::response<http::string_body> createAirspace(const http::request<http::string_body>& req);

// PUT /api/v1/airspaces/{airspaceId} - 更新空域
http::response<http::string_body> updateAirspace(const http::request<http::string_body>& req, const std::string& airspaceId);

// DELETE /api/v1/airspaces/{airspaceId} - 删除空域
http::response<http::string_body> deleteAirspace(const http::request<http::string_body>& req, const std::string& airspaceId);
```

**数据库表**: `airspaces` (需要创建或确认)
**字段**: id, name, type, north_lat, south_lat, east_lng, west_lng, min_altitude, max_altitude, max_concurrent_flights, status, created_at, updated_at

---

#### 4.1.2 无人机管理控制器 (DroneController) - **High**
**文件位置**: `backend/src/controllers/DroneController.h` 和 `.cpp`

需要补充接口：
```cpp
// GET /api/v1/drones/{droneId} - 获取单个无人机详情
http::response<http::string_body> getDroneById(const http::request<http::string_body>& req, const std::string& droneId);
```

**说明**: 后端已有 `/drones` 列表接口（在SystemMonitorController），需要添加单个查询接口

---

#### 4.1.3 飞行许可控制器补充 - **High**
需要在 `FlightPermitController.cpp` 中添加：
```cpp
// GET /api/v1/flight-permits/{permitId} - 获取单个许可详情
http::response<http::string_body> getFlightPermitById(const http::request<http::string_body>& req, const std::string& permitId);

// POST /api/v1/flight-permits/{permitId}/revoke - 撤销许可
http::response<http::string_body> revokeFlightPermit(const http::request<http::string_body>& req, const std::string& permitId);
```

---

#### 4.1.4 应急降落点控制器补充 - **High**
需要在 `EmergencyLandingController.cpp` 中添加：
```cpp
// GET /api/v1/emergency-landing-points/{id} - 获取单个降落点详情
http::response<http::string_body> getEmergencyLandingPointById(const http::request<http::string_body>& req, const std::string& id);

// DELETE /api/v1/emergency-landing-points/{id} - 删除降落点
http::response<http::string_body> deleteEmergencyLandingPoint(const http::request<http::string_body>& req, const std::string& id);
```

---

#### 4.1.5 冲突检测控制器补充 - **Medium**
需要在 `ConflictDetectionController.cpp` 中添加：
```cpp
// POST /api/v1/conflict-detection/flights/batch - 批量检测
http::response<http::string_body> detectMultipleFlightConflicts(const http::request<http::string_body>& req);

// GET /api/v1/conflict-detection/conflicts/{id} - 获取冲突详情
http::response<http::string_body> getConflictById(const http::request<http::string_body>& req, const std::string& id);

// GET /api/v1/conflict-detection/conflicts/statistics - 冲突统计
http::response<http::string_body> getConflictStatistics(const http::request<http::string_body>& req);
```

---

### 4.2 需要调整的前端调用

#### 4.2.1 统一baseURL使用代理
**文件**: `flightTaskApi.js`, `emergencyLandingApi.js`, `conflictDetectionApi.js`, `systemMonitorApi.js`

**修改前**:
```javascript
this.baseURL = 'http://localhost:8081/api/v1/tasks'
```

**修改后**:
```javascript
this.baseURL = '/api/v1/tasks' // 使用相对路径，通过Vue代理转发
```

**原因**: 保持与其他API文件一致，避免跨域问题

---

#### 4.2.2 添加可选参数支持
**文件**: `authApi.js`

**建议**: 在login和register方法中添加role参数支持：
```javascript
async login(loginData) {
  try {
    // 如果前端需要角色验证，可以添加role字段
    const payload = {
      username: loginData.username,
      password: loginData.password,
      // role: loginData.role // 可选，用于角色验证
    }

    const response = await this.api.post('/login', payload)
    // ...
  }
}
```

---

#### 4.2.3 emergencyApi.js 添加 drone_id 支持
**文件**: `emergencyApi.js`

**建议**: 在createEvent方法中支持drone_id参数：
```javascript
async createEvent(eventData) {
  try {
    const payload = {
      task_id: eventData.task_id,
      drone_id: eventData.drone_id, // 添加此字段
      type: eventData.type,
      severity: eventData.severity,
      title: eventData.title,
      description: eventData.description,
      location: eventData.location
    }

    const response = await this.api.post('/events', payload)
    return response.data
  } catch (error) {
    // ...
  }
}
```

---

### 4.3 需要补充的前端页面

#### 4.3.1 空域管理页面 - **Critical**
**文件位置**: `src/views/AirspaceManagement.vue`

**功能需求**:
- 空域列表展示（表格或地图）
- 空域创建表单
- 空域编辑功能
- 空域删除功能
- 空域详情查看
- 空域状态管理

**使用API**: `airspaceApi.js` (已实现前端接口，等待后端)

---

#### 4.3.2 无人机详情页面增强 - **Medium**
**文件位置**: `src/views/DroneDetail.vue` (如果存在) 或增强现有页面

**功能需求**:
- 单个无人机详情查看
- 无人机状态监控
- 无人机历史轨迹
- 无人机告警信息

**使用API**: `droneApi.getDroneById()`

---

#### 4.3.3 冲突检测统计页面 - **Low**
**文件位置**: `src/views/ConflictStatistics.vue`

**功能需求**:
- 冲突统计图表
- 冲突趋势分析
- 按严重程度分类
- 按时间段统计

**使用API**: `conflictDetectionApi.getConflictStatistics()`

---

## 五、路由注册检查建议

### 5.1 需要在后端main.cpp中注册的新路由

```cpp
// 空域管理路由 (新增)
server.addRoute("/api/v1/airspaces", Method::GET,
    [airspaceController](const auto& req) {
        return airspaceController->getAirspaces(req);
    });
server.addRoute("/api/v1/airspaces", Method::POST,
    [airspaceController](const auto& req) {
        return airspaceController->createAirspace(req);
    });
server.addRoute("/api/v1/airspaces/{id}", Method::GET,
    [airspaceController](const auto& req, const auto& params) {
        return airspaceController->getAirspaceById(req, params.at("id"));
    });
server.addRoute("/api/v1/airspaces/{id}", Method::PUT,
    [airspaceController](const auto& req, const auto& params) {
        return airspaceController->updateAirspace(req, params.at("id"));
    });
server.addRoute("/api/v1/airspaces/{id}", Method::DELETE,
    [airspaceController](const auto& req, const auto& params) {
        return airspaceController->deleteAirspace(req, params.at("id"));
    });

// 无人机详情路由 (新增)
server.addRoute("/api/v1/drones/{id}", Method::GET,
    [droneController](const auto& req, const auto& params) {
        return droneController->getDroneById(req, params.at("id"));
    });

// 飞行许可补充路由 (新增)
server.addRoute("/api/v1/flight-permits/{id}", Method::GET,
    [permitController](const auto& req, const auto& params) {
        return permitController->getFlightPermitById(req, params.at("id"));
    });
server.addRoute("/api/v1/flight-permits/{id}/revoke", Method::POST,
    [permitController](const auto& req, const auto& params) {
        return permitController->revokeFlightPermit(req, params.at("id"));
    });

// 应急降落点补充路由 (新增)
server.addRoute("/api/v1/emergency-landing-points/{id}", Method::GET,
    [landingController](const auto& req, const auto& params) {
        return landingController->getEmergencyLandingPointById(req, params.at("id"));
    });
server.addRoute("/api/v1/emergency-landing-points/{id}", Method::DELETE,
    [landingController](const auto& req, const auto& params) {
        return landingController->deleteEmergencyLandingPoint(req, params.at("id"));
    });

// 冲突检测补充路由 (新增)
server.addRoute("/api/v1/conflict-detection/flights/batch", Method::POST,
    [conflictController](const auto& req) {
        return conflictController->detectMultipleFlightConflicts(req);
    });
server.addRoute("/api/v1/conflict-detection/conflicts/{id}", Method::GET,
    [conflictController](const auto& req, const auto& params) {
        return conflictController->getConflictById(req, params.at("id"));
    });
server.addRoute("/api/v1/conflict-detection/conflicts/statistics", Method::GET,
    [conflictController](const auto& req) {
        return conflictController->getConflictStatistics(req);
    });
```

---

## 六、数据库表检查

### 6.1 需要确认/创建的数据库表

| 表名 | 状态 | 备注 |
|------|------|------|
| `airspaces` | **需要创建** | 空域管理核心表 |
| `drones` | 需要确认 | 应该已存在，需要确认字段完整性 |
| `flight_permits` | 已存在 | ✅ 已在FlightPermitController中使用 |
| `emergency_landing_points` | 已存在 | ✅ 已在EmergencyLandingController中使用 |
| `flight_conflicts` | 已存在 | ✅ 已在ConflictDetectionController中使用 |
| `emergency_events` | 已存在 | ✅ 已在EmergencyController中使用 |
| `flight_tasks` | 已存在 | ✅ 已在FlightTaskController中使用 |

---

### 6.2 推荐的airspaces表结构

```sql
CREATE TABLE IF NOT EXISTS airspaces (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL COMMENT '空域名称',
    type VARCHAR(50) NOT NULL COMMENT '空域类型: restricted, controlled, uncontrolled',
    north_lat DECIMAL(10, 7) NOT NULL COMMENT '北纬',
    south_lat DECIMAL(10, 7) NOT NULL COMMENT '南纬',
    east_lng DECIMAL(10, 7) NOT NULL COMMENT '东经',
    west_lng DECIMAL(10, 7) NOT NULL COMMENT '西经',
    min_altitude DECIMAL(8, 2) DEFAULT 0 COMMENT '最小高度(米)',
    max_altitude DECIMAL(8, 2) DEFAULT 500 COMMENT '最大高度(米)',
    max_concurrent_flights INT DEFAULT 1 COMMENT '最大并发飞行数',
    status VARCHAR(50) DEFAULT 'active' COMMENT '状态: active, inactive',
    description TEXT COMMENT '描述',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_type (type),
    INDEX idx_status (status),
    INDEX idx_location (north_lat, south_lat, east_lng, west_lng)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='空域管理表';
```

---

## 七、优先级修复计划

### 第一阶段 (Critical - 1周内完成)
1. ✅ **创建AirspaceController** - 实现完整的空域管理后端
2. ✅ **创建airspaces数据库表**
3. ✅ **注册空域管理路由**
4. ✅ **前端统一baseURL使用代理**

### 第二阶段 (High - 2周内完成)
1. ✅ **DroneController补充单个查询接口**
2. ✅ **FlightPermitController补充详情和撤销接口**
3. ✅ **EmergencyLandingController补充详情和删除接口**
4. ✅ **前端添加空域管理页面**

### 第三阶段 (Medium - 3周内完成)
1. ✅ **ConflictDetectionController补充批量检测和统计接口**
2. ✅ **前端参数调整 (role, drone_id等)**
3. ✅ **前端增强无人机详情页面**

### 第四阶段 (Low - 可选)
1. 冲突检测统计页面
2. 系统日志和审计功能
3. 性能优化和缓存机制

---

## 八、测试建议

### 8.1 API测试检查清单
- [ ] 使用Postman/curl测试所有新增接口
- [ ] 验证参数验证逻辑
- [ ] 测试Token认证和权限控制
- [ ] 测试错误处理和返回格式
- [ ] 测试分页功能
- [ ] 测试数据库事务和一致性

### 8.2 前后端集成测试
- [ ] 空域创建、查询、更新、删除流程
- [ ] 无人机详情查询
- [ ] 飞行许可完整流程（申请、审批、撤销）
- [ ] 应急降落点管理流程
- [ ] 冲突检测和解决流程

---

## 九、总结

### 9.1 问题统计
- **前端调用但后端未实现**: 13个接口
- **后端实现但前端未使用**: 0个接口
- **参数不一致**: 3处
- **返回字段不匹配**: 3处
- **URL路径不一致**: 4处

### 9.2 关键发现
1. **空域管理模块完全缺失后端实现** - 这是最严重的问题，影响整个空域管理功能
2. **部分控制器缺少单个查询接口** - DroneController, FlightPermitController, EmergencyLandingController
3. **前端baseURL不统一** - 部分使用完整URL，部分使用相对路径
4. **参数支持不完整** - 后端支持但前端未传递的参数 (role, drone_id)

### 9.3 后续建议
1. **优先实现空域管理后端** - 这是阻塞前端功能的关键
2. **补充缺失的详情查询接口** - 保证CRUD完整性
3. **统一前端API调用方式** - 使用代理配置，避免硬编码
4. **完善API文档** - 建议使用Swagger/OpenAPI生成文档
5. **添加接口测试** - 使用Postman Collection或Jest进行自动化测试

---

**报告生成完成** ✅

> 此报告详细列出了前后端所有不一致的地方，并提供了具体的修复建议和优先级计划。建议团队按照优先级逐步修复，确保系统功能完整性和一致性。
